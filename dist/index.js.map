{"version":3,"file":"index.js","sourceRoot":"./src/","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import express from \"express\";\r\nimport fetch from \"node-fetch\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\nimport { transpile } from \"typescript\";\r\nimport cors from \"cors\";\r\nimport ms from \"ms\";\r\n\r\nconst app = express();\r\n// should match https://github.com/ProdigyPNP/ProdigyMathGameHacking/blob/master/PHEx/src/manifest.json\r\nconst SupportPHEXVersion = \"2.1.9\";\r\nlet lastVersion = \"None\";\r\ninterface GameStatus {\r\n\tstatus: string;\r\n\tdata?: { gameClientVersion?: string; prodigyGameFlags: { gameDataVersion: number } };\r\n}\r\nconst startDate = Date.now();\r\n\r\n// @ts-expect-error\r\nsetInterval(async () => {\r\n\ttry {\r\n\t\tconst status: GameStatus = await (await fetch(\"https://api.prodigygame.com/game-api/status\")).json();\r\n\t\tconsole.log(status);\r\n\t\tconst version = status?.data?.gameClientVersion;\r\n\t\tif (lastVersion === \"None\") return (lastVersion = version!);\r\n\r\n\t\t// write modified gamefile to disk, in case there's a crash\r\n\t} catch (e) {}\r\n}, 10 * 60 * 1000);\r\n\r\napp.use(cors());\r\n// @ts-expect-error\r\napp.get(\"/game.min.js\", async (req, res) => {\r\n    // @ts-expect-error\r\n\tconst version = JSON.parse((await (await fetch('https://play.prodigygame.com/play')).text())\r\n\t.match(/(?<=gameStatusDataStr = ').+(?=')/)[0])\r\n\tconst status = await (await fetch('https://api.prodigygame.com/game-api/status')).json()\r\n\tif (status.status !== \"success\" || !version) return res.sendStatus(503);\r\n\tconst gameMinJS = await (\r\n\t\tawait fetch(`https://code.prodigygame.com/code/${version}/game.min.js?v=${version}`)\r\n\t).text();\r\n\tres.type(\".js\");\r\n\tconst replacements = [\r\n\t\t[\"s),this._game=i}\", `s),this._game=i};jQuery.temp22=_;let nahhh=setInterval(()=>{if (jQuery.temp22 !== _) {_ = jQuery.temp22; delete jQuery.temp22;clearInterval(nahhh)}});Object.defineProperty(_, \"instance\", { get: () => t.instance });`],\r\n\t\t[\"t.constants=Object\", \"_.constants=t,t.constants=Object\"],\r\n\t\t[\"window,function(t){var i={};\", \"window,function(t){var i={};_.modules=i;\"],\r\n\t\t[\"this._player=t\", \"this._player=_.player=t\"],\r\n\t\t[\"i.prototype.hasMembership=\", \"i.prototype.hasMembership=_=>true,i.prototype.originalHasMembership=\"] // membership override\r\n\t\t// [\"this._localizer=null,this.et=[]\", \"_.chat=this;this._localizer=null,this.et=[]\"],\r\n\t\t// [\"return t.BAM=\", \";_.variables.loc=Ar;_.variables.menuTxt=Kr;_.variables.menuObj=t;return t.BAM=\"],\r\n\t];\r\n\treturn res.send(\r\n\t\treplacements.reduce(\r\n\t\t\t(code, replacement) => code.split(replacement[0]).join(replacement[1]),\r\n\t\t\t`nootmeat = func => {\r\n\t\t\t\tlet elephant = 2\r\n\t\t\t}\r\n\t\t\texports = {};\r\n\t\t\t_.variables=Object.create(null);\r\n\r\n\t\t\tconsole.trace = _ => {};\r\n\t\r\n\t\t\t${gameMinJS}\r\n\r\n\t\t\t${transpile(fs.readFileSync(path.join(__dirname, \"./revival.ts\"), { encoding: \"utf8\" }))}\r\n\r\n\t\t\tconsole.log(\"%cWill's Redirect Hack\", \"font-size:40px;color:#540052;font-weight:900;font-family:sans-serif;\");\r\n\t\t\tconsole.log(\"%cVersion ${SupportPHEXVersion}\", \"font-size:20px;color:#000025;font-weight:700;font-family:sans-serif;\");\r\n\t\t\tconsole.log('The variable \"_\" contains the hacked variables.');\r\n\t\t\tSW.Load.onGameLoad();\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t${await (await fetch(\"https://raw.githubusercontent.com/Prodigy-Hacking/ProdigyMathGameHacking/master/willsCheatMenu/loader.js\")).text()}\r\n\t\t\t}, 15000);\r\n\t\t`)\r\n\t);\r\n});\r\n\r\n// @ts-expect-error\r\napp.get(\"/\", (req, res) => res.redirect(\"/game.min.js\"));\r\n\r\napp.get(\"/public-game.min.js\", async (req, res) => {\r\n\tif (!req.query.hash) return res.send(\"alert('OUTDATED REDIRECTOR CONFIG')\")\r\n\tconst publicGame = await (await fetch(`https://code.prodigygame.com/js/public-game-${req.query.hash}.min.js`)).text();\r\n\tres.type(\".js\");\r\n\treturn res.send(`\r\n\t\t${publicGame.replace(/console\\..+?\\(.*?\\)/g, \"(()=>{})()\")}\r\n\r\n\t\t// overwrite Array.some to patch Prodigy's anti-cheat.\r\n\t\t// The Anti-Anti-Cheat\r\n\t\tl=Array.prototype.some;\r\n\t\tsetInterval(()=>{Array.prototype.some = function some(...args) {\r\n\t\t\tif (this[0] === \"hack\") this.splice(0, 100);\r\n\t\t\treturn l.call(this, ...args);\r\n\t\t}});\r\n\t\t\r\n\t\t// Prodigy's new hack var anti-cheat overwrote setInterval, to patch this, we get a fresh new setInterval from an iFrame,\r\n\t\t// then patch their patch.\r\n\t\tlet fffffff = document.createElement(\"iframe\");\r\n\t\tdocument.head.append(fffffff);\r\n\t\tfffffff.contentWindow.setInterval(() => {\r\n\t\t\tlet l = fffffff.contentWindow.setInterval;\r\n\t\t\twindow.setInterval = function(func, ...args) {\r\n\t\t\t\tif (func.toString().includes('[\"hack\"]')) return;\r\n\t\t\t\treturn l.call(window, func, ...args);\r\n\t\t\t}\r\n\t\t});\r\n\t`);\r\n});\r\n\r\n\r\n// @ts-expect-error\r\napp.get(\"/download\", async (req, res) => {\r\n\treturn res.redirect(\"https://github.com/ProdigyPNP/ProdigyMathGameHacking/raw/master/PHEx/build/extension.zip\");\r\n});\r\n\r\n\r\n// @ts-expect-error\r\napp.get(\"/version\", async (req, res) => {\r\n\treturn res.send(SupportPHEXVersion);\r\n});\r\n\r\n\r\n// @ts-expect-error\r\napp.get(\"/status\", async (req, res) => {\r\n\treturn res.send(`Redirector has been online for [${ms(Date.now() - startDate)}]`)\r\n});\r\n\r\n\r\nconst port = process.env.PORT ?? 1337;\r\napp.listen(port, () => {\r\n    return console.log(`The old machine hums along on port :${port}`)\r\n    }\r\n);"]}