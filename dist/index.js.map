{"version":3,"file":"index.js","sourceRoot":"./src/","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import express from \"express\";\r\nimport fetch from \"node-fetch\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\nimport { transpile } from \"typescript\";\r\nimport cors from \"cors\";\r\nimport ms from \"ms\";\r\n\r\nconst app = express();\r\n// should match https://github.com/ProdigyPNP/ProdigyMathGameHacking/blob/master/PHEx/src/manifest.json\r\nconst SupportPHEXVersion = \"2.1.9\";\r\nlet lastVersion = \"None\";\r\ninterface GameStatus {\r\n\tstatus: string;\r\n\tdata?: { gameClientVersion?: string; prodigyGameFlags: { gameDataVersion: number } };\r\n}\r\nconst startDate = Date.now();\r\n\r\n// @ts-expect-error\r\nsetInterval(async () => {\r\n\ttry {\r\n\t\tconst status: GameStatus = await (await fetch(\"https://api.prodigygame.com/game-api/status\")).json();\r\n\t\tconsole.log(status);\r\n\t\tconst version = status?.data?.gameClientVersion;\r\n\t\tif (lastVersion === \"None\") return (lastVersion = version!);\r\n\r\n\t\t// write modified gamefile to disk, in case there's a crash\r\n\t} catch (e) {}\r\n}, 10 * 60 * 1000);\r\n\r\napp.use(cors());\r\n// @ts-expect-error\r\napp.get(\"/game.min.js\", async (req, res) => {\r\n    // @ts-expect-error\r\n\tconst version = JSON.parse((await (await fetch('https://play.prodigygame.com/play')).text())\r\n\t.match(/(?<=gameStatusDataStr = ').+(?=')/)[0])\r\n\tconst status = await (await fetch('https://api.prodigygame.com/game-api/status')).json()\r\n\tif (status.status !== \"success\" || !version) return res.sendStatus(503);\r\n\tconst gameMinJS = await (\r\n\t\tawait fetch(`https://code.prodigygame.com/code/${version}/game.min.js?v=${version}`)\r\n\t).text();\r\n\tres.type(\".js\");\r\n\tconst replacements = [\r\n\t\t[\"s),this._game=i}\", `s),this._game=i};jQuery.temp22=_;let nahhh=setInterval(()=>{if (jQuery.temp22 !== _) {_ = jQuery.temp22; delete jQuery.temp22;clearInterval(nahhh)}});Object.defineProperty(_, \"instance\", { get: () => t.instance });`],\r\n\t\t[\"t.constants=Object\", \"_.constants=t,t.constants=Object\"],\r\n\t\t[\"window,function(t){var i={};\", \"window,function(t){var i={};_.modules=i;\"],\r\n\t\t[\"this._player=t\", \"this._player=_.player=t\"],\r\n\t\t[\"i.prototype.hasMembership=\", \"i.prototype.hasMembership=_=>true,i.prototype.originalHasMembership=\"] // membership override\r\n\t\t// [\"this._localizer=null,this.et=[]\", \"_.chat=this;this._localizer=null,this.et=[]\"],\r\n\t\t// [\"return t.BAM=\", \";_.variables.loc=Ar;_.variables.menuTxt=Kr;_.variables.menuObj=t;return t.BAM=\"],\r\n\t];\r\n\treturn res.send(\r\n\t\treplacements.reduce(\r\n\t\t\t(code, replacement) => code.split(replacement[0]).join(replacement[1]),\r\n\t\t\t`nootmeat = func => {\r\n\t\t\t\tlet elephant = 2\r\n\t\t\t}\r\n\t\t\texports = {};\r\n\t\t\t_.variables=Object.create(null);\r\n\r\n\t\t\tconsole.trace = _ => {};\r\n\t\r\n\t\t\t${gameMinJS}\r\n\r\n\t\t\t${transpile(fs.readFileSync(path.join(__dirname, \"./revival.ts\"), { encoding: \"utf8\" }))}\r\n\r\n\t\t\tconsole.log(\"%cWill's Redirect Hack\", \"font-size:40px;color:#540052;font-weight:900;font-family:sans-serif;\");\r\n\t\t\tconsole.log(\"%cVersion ${SupportPHEXVersion}\", \"font-size:20px;color:#000025;font-weight:700;font-family:sans-serif;\");\r\n\t\t\tconsole.log('The variable \"_\" contains the hacked variables.');\r\n\t\t\tSW.Load.onGameLoad();\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t${await (await fetch(\"https://raw.githubusercontent.com/Prodigy-Hacking/ProdigyMathGameHacking/master/willsCheatMenu/loader.js\")).text()}\r\n\t\t\t}, 15000);\r\n\t\t`)\r\n\t);\r\n});\r\n\r\n// @ts-expect-error\r\napp.get(\"/\", (req, res) => res.redirect(\"/game.min.js\"));\r\n\r\napp.get(\"/public-game.min.js\", async (req, res) => {\r\n\tif (!req.query.hash) return res.send(\"alert('OUTDATED REDIRECTOR CONFIG')\")\r\n\tconst publicGame = await (await fetch(`https://code.prodigygame.com/js/public-game-${req.query.hash}.min.js`)).text();\r\n\tres.type(\".js\");\r\n\treturn res.send(`\r\n\t\t${publicGame.replace(/console\\..+?\\(.*?\\)/g, \"(()=>{})()\")}\r\n\r\n\t\t// overwrite Array.some to patch Prodigy's anti-cheat.\r\n\t\t// The Anti-Anti-Cheat\r\n\t\tl=Array.prototype.some;\r\n\t\tsetInterval(()=>{Array.prototype.some = function some(...args) {\r\n\t\t\tif (this[0] === \"hack\") this.splice(0, 100);\r\n\t\t\treturn l.call(this, ...args);\r\n\t\t}});\r\n\t\t\r\n\t\t// Prodigy's new hack var anti-cheat overwrote setInterval, to patch this, we get a fresh new setInterval from an iFrame,\r\n\t\t// then patch their patch.\r\n\t\tlet fffffff = document.createElement(\"iframe\");\r\n\t\tdocument.head.append(fffffff);\r\n\t\tfffffff.contentWindow.setInterval(() => {\r\n\t\t\tlet l = fffffff.contentWindow.setInterval;\r\n\t\t\twindow.setInterval = function(func, ...args) {\r\n\t\t\t\tif (func.toString().includes('[\"hack\"]')) return;\r\n\t\t\t\treturn l.call(window, func, ...args);\r\n\t\t\t}\r\n\t\t});\r\n\t`);\r\n});\r\n\r\n\r\n// @ts-expect-error\r\napp.get(\"/download\", async (req, res) => {\r\n\treturn res.redirect(\"https://github.com/ProdigyPNP/ProdigyMathGameHacking/raw/master/PHEx/build/extension.zip\");\r\n});\r\n\r\n\r\n// @ts-expect-error\r\napp.get(\"/version\", async (req, res) => {\r\n\treturn res.send(SupportPHEXVersion);\r\n});\r\n\r\n\r\n// @ts-expect-error\r\napp.get(\"/status\", async (req, res) => {\r\n\treturn res.send(`Redirector has been online for [${ms(Date.now() - startDate)}]`)\r\n});\r\n\r\n\r\nconst port = process.env.PORT ?? 1337;\r\napp.listen(port, () => {\r\n    return console.log(`The old machine hums along on port :${port}`)\r\n    }\r\n);"]}